export const colorWheelCanvas = document.querySelector('#color-wheel');
export const canvasSize = colorWheelCanvas.clientWidth;
export const radius = 0.45
const glCanvas = document.createElement('canvas');
const gl = glCanvas.getContext('webgl2', { antialias: false });

main();
function main() {
  if (!gl) {
    alert('Unable to initialize WebGL. Your browser or machine may not support it.');
    return;
  }
  
  gl.enable(gl.BLEND);
  gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);
  const alignment = 1;
  gl.pixelStorei(gl.UNPACK_ALIGNMENT, alignment);

  const vertexShaderSource = `#version 300 es
in vec2 position;
void main() {
  gl_Position = vec4(position * 2.0 - 1.0, 0, 1.0);
}
`;
  const fragmentShaderSource = `#version 300 es
// mediump is a good default
precision mediump float;

out vec4 COLOR;

const float RADIUS = ${radius};
const float TAU = ${Math.PI * 2};
const float PI = ${Math.PI};

uniform sampler2D hues;
uniform vec2 resolution;


// Inverse function for L_r (Luminance)
float reference_white_luminance_to_luminance(float x) {
    const float k_1 = 0.206;
    const float k_2 = 0.03;
    const float k_3 = (1.0 + k_1) / (1.0 + k_2);
    return (x * x + k_1 * x) / (k_3 * (x + k_2));
}

// Convert OKLab to linear RGB
vec3 oklab_to_srgb(float L, float a, float b) {
    float l_ = L + 0.3963377774 * a + 0.2158037573 * b;
    float m_ = L - 0.1055613458 * a - 0.0638541728 * b;
    float s_ = L - 0.0894841775 * a - 1.2914855480 * b;

    float l = pow(l_, 3.0);
    float m = pow(m_, 3.0);
    float s = pow(s_, 3.0);

    return vec3(
        4.0767416621 * l - 3.3077115913 * m + 0.2309699292 * s,
        -1.2684380046 * l + 2.6097574011 * m - 0.3413193965 * s,
        -0.0041960863 * l - 0.7034186147 * m + 1.7076147010 * s
    );
}

vec3 srgb_to_oklab(float r, float g, float b) {
    vec3 rgb = vec3(r, g, b);

    // Convert non-linear RGB to linear RGB
    for (int i = 0; i < 3; i++) {
        if (rgb[i] <= 0.04045) {
            rgb[i] = rgb[i] / 12.92;
        } else {
            rgb[i] = pow((rgb[i] + 0.055) / 1.055, 2.4);
        }
    }
    r = rgb.r;
    g = rgb.g;
    b = rgb.b;

    // Apply transformation to linear RGB
    float l = 0.4122214708 * r + 0.5363325363 * g + 0.0514459929 * b;
    float m = 0.2119034982 * r + 0.6806995451 * g + 0.1073969566 * b;
    float s = 0.0883024619 * r + 0.2817188376 * g + 0.6299787005 * b;

    // Compute cube roots of l, m, and s
    float l_ = pow(l, 1.0 / 3.0);
    float m_ = pow(m, 1.0 / 3.0);
    float s_ = pow(s, 1.0 / 3.0);

    // Convert to OKLab space
    float L = 0.2104542553 * l_ + 0.7936177850 * m_ - 0.0040720468 * s_;
    float A = 1.9779984951 * l_ - 2.4285922050 * m_ + 0.4505937099 * s_;
    float B = 0.0259040371 * l_ + 0.7827717662 * m_ - 0.8086757660 * s_;

    return vec3(L, A, B);
}


// Convert linear RGB to non-linear RGB
vec3 linear_rgb_to_srgb(float r, float g, float b) {
    vec3 rgb = vec3(r, g, b);
    for (int i = 0; i < 3; i++) {
        if (rgb[i] <= 0.0031308) {
            rgb[i] = rgb[i] * 12.92;
        } else {
            rgb[i] = pow(rgb[i], 1.0 / 2.4) * 1.055 - 0.055;
        }
    }
    return rgb;
}

vec3 hsv_to_rgb(float hue, float saturation, float value) {
    float chroma = saturation * value;
    float min_rgb = value - chroma;
    float r = clamp(abs(chroma * 6.0 * hue - 3.0 * chroma) - 1.0 * chroma, 0.0, chroma);
    float g = clamp(-abs(chroma * 6.0 * hue - 2.0 * chroma) + 2.0 * chroma, 0.0, chroma);
    float b = clamp(-abs(chroma * 6.0 * hue - 4.0 * chroma) + 2.0 * chroma, 0.0, chroma);
    return vec3(min_rgb + r, min_rgb + g, min_rgb + b);
}

vec3 get_rgb(float hue, float saturation, float value) {
	vec3 rgb = hsv_to_rgb(hue, 1.0, 1.0);
	vec3 lab = srgb_to_oklab(rgb[0], rgb[1], rgb[2]);
	float L_cusp = lab[0];
    float ok_a = lab[1];
    float ok_b = lab[2];
	float C_cusp = sqrt(ok_a * ok_a + ok_b * ok_b);
	ok_a = ok_a / C_cusp;
	ok_b = ok_b / C_cusp;

    // Maximum saturation and value calculations
    float S_max = C_cusp / L_cusp;
    float T_max = C_cusp / (1.0 - L_cusp);

    float S_0 = 0.5;
    float k = 1.0 - S_0 / S_max;
    float L_v = 1.0 - saturation * S_0 / (S_0 + T_max - T_max * k * saturation);
    float C_v = saturation * T_max * S_0 / (S_0 + T_max - T_max * k * saturation);

    // Compute final L and C values
    float L = value * L_v;
    float C = value * C_v;

    float L_vt = reference_white_luminance_to_luminance(L_v);
    float C_vt = C_v * L_vt / L_v;
    float L_new = reference_white_luminance_to_luminance(L);
    C = C * L_new / L;
    L = L_new;

    vec3 scale_rgb = oklab_to_srgb(L_vt, ok_a * C_vt, ok_b * C_vt);
    float scale_L = pow(1.0 / max(scale_rgb.r, max(scale_rgb.g, scale_rgb.b)), 1.0 / 3.0);
    L *= scale_L;
    C *= scale_L;

    vec3 linear_rgb = oklab_to_srgb(L, C * ok_a, C * ok_b);
    return linear_rgb_to_srgb(linear_rgb.r, linear_rgb.g, linear_rgb.b);
}

vec3 get_color(vec2 pos, float distance_center) {
	// Linear at the edges, more white in the center, gradual change
	float saturation = -0.553 * cos(0.8 * PI * distance_center / RADIUS) + 0.553;
	float value = 1.0;
	float hue = atan(-pos.y, pos.x) / TAU + 0.5;
    hue = texture(hues, vec2(hue,0.0)).r;
	return get_rgb(hue, saturation, value);
}

void main() {
    vec2 uv = vec2(1.0,-1.0) * (0.5 - gl_FragCoord.xy / resolution);
    float distance_center = length(uv);
    if (distance_center <= RADIUS)
    {
        float alpha = clamp((RADIUS - distance_center) * resolution.y * 0.5, 0.0, 1.0);
        COLOR = vec4(get_color(uv, distance_center), alpha);
    }
}
`;
  
  const vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexShaderSource);
  const fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentShaderSource);
  const program = createProgram(gl, vertexShader, fragmentShader);
  gl.useProgram(program);

  setPositions(program);
  const resolutionUniformLocation = gl.getUniformLocation(program, 'resolution');
  try {
    setHues(program);
  } catch (e) {
    // Do nothing
  }
  
  const draw = () => drawScene(resolutionUniformLocation);
  window.onresize = draw;
  draw()
}

function drawScene(resolutionUniformLocation) {
  glCanvas.width = 
      glCanvas.height = Math.floor(canvasSize * window.devicePixelRatio);
  gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);
  gl.uniform2f(resolutionUniformLocation, glCanvas.width, glCanvas.height);
  const primitiveType = gl.TRIANGLES;
  const offset = 0;
  const count = 6;
  gl.drawArrays(primitiveType, offset, count);
  toImage(glCanvas.width, glCanvas.height);
}

function setPositions(program) {
  const positionBuffer = gl.createBuffer();
  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
        0.0, 0.0, 
        1.0, 0.0, 
        0.0, 1.0,

        1.0, 0.0, 
        1.0, 1.0, 
        0.0, 1.0,
      ]), gl.STATIC_DRAW);
  // Tell the attribute how to get data out of positionBuffer (ARRAY_BUFFER)
  const positionLocation = gl.getAttribLocation(program, 'position');
  const size = 2; // 2 components per iteration
  const type = gl.FLOAT;
  const normalize = false;
  const stride = 0; // 0 = move forward size * sizeof(type) each iteration to get the next position
  let offset = 0; // start at the beginning of the buffer
  gl.vertexAttribPointer(positionLocation, size, type, normalize, stride, offset);
  gl.enableVertexAttribArray(positionLocation);
}

function toImage(width, height) {
  const pixels = new Uint8Array(width * height * 4); // 4 bytes per pixel (RGBA)
  gl.readPixels(0, 0, width, height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);
  colorWheelCanvas.width = width;
  colorWheelCanvas.height = height;
  const ctx = colorWheelCanvas.getContext('2d');
  const imageData = new ImageData(new Uint8ClampedArray(pixels), width, height);
  ctx.putImageData(imageData, 0, 0);
  // Here it is not accounted for that the gl origin is in the bottom left. This is done inside the shader.
  // rescale
  colorWheelCanvas.style.width = 
      colorWheelCanvas.style.width = canvasSize + 'px';
}

function setHues(program) {
  gl.bindTexture(gl.TEXTURE_2D, gl.createTexture());
  const level = 0;
  const internalFormat = gl.R32F;
  const width = 1000;
  const height = 1;
  const border = 0;
  const format = gl.RED;
  const type = gl.FLOAT;
  const data = new Float32Array([0.0, 0.00457516339869281, 0.00980392156862745, 0.013071895424836602, 0.016339869281045753, 0.01895424836601307, 0.02091503267973856, 0.02287581699346405, 0.024836601307189544, 0.02679738562091503, 0.028758169934640525, 0.030065359477124184, 0.03137254901960784, 0.03333333333333333, 0.034640522875816995, 0.03594771241830065, 0.03725490196078431, 0.038562091503267976, 0.0392156862745098, 0.040522875816993466, 0.04183006535947712, 0.043137254901960784, 0.04379084967320262, 0.045098039215686274, 0.046405228758169936, 0.047058823529411764, 0.04836601307189542, 0.04901960784313726, 0.05032679738562092, 0.050980392156862744, 0.05228758169934641, 0.052941176470588235, 0.05359477124183006, 0.054901960784313725, 0.05555555555555555, 0.05686274509803921, 0.05751633986928105, 0.05816993464052288, 0.058823529411764705, 0.06013071895424837, 0.060784313725490195, 0.06143790849673202, 0.06274509803921569, 0.06339869281045751, 0.06405228758169934, 0.06470588235294117, 0.06535947712418301, 0.06666666666666667, 0.0673202614379085, 0.06797385620915032, 0.06862745098039216, 0.06928104575163399, 0.06993464052287582, 0.07124183006535947, 0.0718954248366013, 0.07254901960784313, 0.07320261437908496, 0.0738562091503268, 0.07450980392156863, 0.07516339869281045, 0.07581699346405228, 0.07647058823529412, 0.07777777777777778, 0.0784313725490196, 0.07908496732026143, 0.07973856209150328, 0.0803921568627451, 0.08104575163398693, 0.08169934640522876, 0.08235294117647059, 0.08300653594771241, 0.08366013071895424, 0.08431372549019607, 0.08496732026143791, 0.08562091503267974, 0.08627450980392157, 0.0869281045751634, 0.08758169934640524, 0.08823529411764706, 0.08888888888888889, 0.08954248366013072, 0.09019607843137255, 0.09084967320261438, 0.0915032679738562, 0.09215686274509804, 0.09281045751633987, 0.0934640522875817, 0.09411764705882353, 0.09477124183006536, 0.09542483660130718, 0.09607843137254901, 0.09673202614379084, 0.0973856209150327, 0.09803921568627452, 0.09869281045751635, 0.09934640522875818, 0.1, 0.10065359477124183, 0.10130718954248366, 0.10130718954248366, 0.10196078431372549, 0.10261437908496732, 0.10326797385620916, 0.10392156862745099, 0.10457516339869281, 0.10522875816993464, 0.10588235294117647, 0.1065359477124183, 0.10718954248366012, 0.10784313725490195, 0.1084967320261438, 0.10915032679738562, 0.10980392156862745, 0.11045751633986928, 0.11045751633986928, 0.1111111111111111, 0.11176470588235293, 0.11241830065359476, 0.11307189542483659, 0.11372549019607842, 0.11437908496732027, 0.1150326797385621, 0.11568627450980393, 0.11633986928104575, 0.11699346405228758, 0.11764705882352941, 0.11764705882352941, 0.11830065359477124, 0.11895424836601307, 0.11960784313725491, 0.12026143790849673, 0.12091503267973856, 0.12156862745098039, 0.12222222222222222, 0.12287581699346405, 0.12287581699346405, 0.12352941176470587, 0.1241830065359477, 0.12483660130718953, 0.12549019607843137, 0.1261437908496732, 0.12679738562091503, 0.12745098039215685, 0.12810457516339868, 0.1287581699346405, 0.1287581699346405, 0.12941176470588234, 0.13006535947712417, 0.13071895424836602, 0.13137254901960785, 0.13202614379084968, 0.1326797385620915, 0.13333333333333333, 0.13398692810457516, 0.134640522875817, 0.134640522875817, 0.13529411764705881, 0.13594771241830064, 0.1366013071895425, 0.13725490196078433, 0.13790849673202615, 0.13856209150326798, 0.1392156862745098, 0.13986928104575164, 0.13986928104575164, 0.14052287581699346, 0.1411764705882353, 0.14183006535947712, 0.14248366013071895, 0.14313725490196078, 0.1437908496732026, 0.14444444444444443, 0.14444444444444443, 0.14509803921568626, 0.1457516339869281, 0.14640522875816991, 0.14705882352941174, 0.1477124183006536, 0.14836601307189543, 0.14901960784313725, 0.14901960784313725, 0.14967320261437908, 0.1503267973856209, 0.15098039215686274, 0.15163398692810456, 0.1522875816993464, 0.15294117647058825, 0.15294117647058825, 0.15359477124183007, 0.1542483660130719, 0.15490196078431373, 0.15555555555555556, 0.15620915032679739, 0.1568627450980392, 0.15751633986928104, 0.15751633986928104, 0.15816993464052287, 0.15882352941176472, 0.15947712418300655, 0.16013071895424838, 0.1607843137254902, 0.16143790849673204, 0.16209150326797386, 0.16209150326797386, 0.1627450980392157, 0.16339869281045752, 0.16405228758169935, 0.16470588235294117, 0.165359477124183, 0.16601307189542483, 0.16601307189542483, 0.16666666666666666, 0.1679738562091503, 0.16862745098039214, 0.16993464052287582, 0.17124183006535948, 0.1718954248366013, 0.17320261437908496, 0.1738562091503268, 0.17516339869281047, 0.17647058823529413, 0.17712418300653596, 0.1784313725490196, 0.17973856209150327, 0.1803921568627451, 0.18169934640522875, 0.1830065359477124, 0.18366013071895426, 0.18496732026143792, 0.18627450980392157, 0.18758169934640523, 0.18823529411764706, 0.1895424836601307, 0.19084967320261437, 0.1915032679738562, 0.19281045751633985, 0.1941176470588235, 0.19542483660130722, 0.19673202614379087, 0.1973856209150327, 0.19869281045751636, 0.2, 0.20130718954248367, 0.20261437908496732, 0.20326797385620915, 0.2045751633986928, 0.2058823529411765, 0.20718954248366014, 0.2084967320261438, 0.20980392156862746, 0.2111111111111111, 0.21241830065359477, 0.21372549019607842, 0.21503267973856208, 0.21633986928104573, 0.21764705882352942, 0.21895424836601307, 0.22026143790849673, 0.22156862745098038, 0.22287581699346404, 0.2241830065359477, 0.22549019607843135, 0.226797385620915, 0.22875816993464054, 0.2300653594771242, 0.23137254901960785, 0.2326797385620915, 0.234640522875817, 0.23594771241830065, 0.2372549019607843, 0.23921568627450981, 0.24052287581699347, 0.24248366013071895, 0.2437908496732026, 0.2457516339869281, 0.24705882352941175, 0.24901960784313723, 0.25098039215686274, 0.2529411764705882, 0.2542483660130719, 0.25620915032679736, 0.25816993464052285, 0.26013071895424833, 0.2627450980392157, 0.2647058823529412, 0.26666666666666666, 0.269281045751634, 0.27124183006535946, 0.2738562091503268, 0.27647058823529413, 0.27908496732026145, 0.2823529411764706, 0.2849673202614379, 0.28823529411764703, 0.292156862745098, 0.296078431372549, 0.3006535947712418, 0.3052287581699346, 0.31176470588235294, 0.3209150326797386, 0.33660130718954245, 0.3457516339869281, 0.35228758169934643, 0.3568627450980392, 0.3607843137254902, 0.36470588235294116, 0.3679738562091503, 0.3705882352941176, 0.3732026143790849, 0.37581699346405223, 0.37843137254901965, 0.38104575163398696, 0.3830065359477124, 0.38496732026143793, 0.38692810457516336, 0.3888888888888889, 0.39084967320261443, 0.39281045751633986, 0.3941176470588235, 0.39607843137254906, 0.3980392156862745, 0.39934640522875814, 0.40065359477124185, 0.40261437908496733, 0.403921568627451, 0.40588235294117647, 0.4071895424836601, 0.4084967320261438, 0.40980392156862744, 0.4111111111111111, 0.41307189542483663, 0.4143790849673203, 0.41568627450980394, 0.4169934640522876, 0.41830065359477125, 0.4196078431372549, 0.42091503267973857, 0.4222222222222222, 0.4235294117647059, 0.42483660130718953, 0.4261437908496732, 0.42745098039215684, 0.4281045751633987, 0.4294117647058824, 0.43071895424836604, 0.4320261437908497, 0.43333333333333335, 0.434640522875817, 0.43529411764705883, 0.4366013071895425, 0.43790849673202614, 0.4392156862745098, 0.44052287581699345, 0.4411764705882353, 0.44248366013071894, 0.4437908496732026, 0.4450980392156863, 0.4457516339869281, 0.44705882352941173, 0.4483660130718954, 0.44901960784313727, 0.4503267973856209, 0.4516339869281046, 0.45228758169934635, 0.45359477124183, 0.45490196078431366, 0.45555555555555555, 0.4568627450980392, 0.45816993464052286, 0.45882352941176474, 0.4601307189542484, 0.46143790849673205, 0.4620915032679738, 0.4633986928104575, 0.46405228758169936, 0.465359477124183, 0.4666666666666667, 0.46732026143790856, 0.4686274509803922, 0.469281045751634, 0.47058823529411764, 0.4718954248366013, 0.4725490196078432, 0.47385620915032683, 0.4745098039215686, 0.47581699346405226, 0.4771241830065359, 0.4777777777777778, 0.47908496732026146, 0.4797385620915033, 0.48104575163398694, 0.48169934640522877, 0.4830065359477124, 0.4843137254901961, 0.4849673202614379, 0.48627450980392156, 0.4869281045751634, 0.48823529411764705, 0.4888888888888889, 0.49019607843137253, 0.4908496732026144, 0.49215686274509807, 0.49281045751633984, 0.4941176470588235, 0.4947712418300654, 0.49607843137254903, 0.4973856209150327, 0.49803921568627446, 0.4993464052287581, 0.5, 0.5006535947712418, 0.5013071895424837, 0.5019607843137255, 0.5019607843137255, 0.5026143790849673, 0.5032679738562091, 0.503921568627451, 0.503921568627451, 0.5045751633986928, 0.5052287581699346, 0.5058823529411764, 0.5065359477124183, 0.5065359477124183, 0.5071895424836601, 0.5078431372549019, 0.5084967320261438, 0.5084967320261438, 0.5091503267973856, 0.5098039215686274, 0.5104575163398692, 0.5111111111111111, 0.5111111111111111, 0.511764705882353, 0.5124183006535947, 0.5130718954248367, 0.5130718954248367, 0.5137254901960784, 0.5143790849673203, 0.515032679738562, 0.515686274509804, 0.515686274509804, 0.5163398692810457, 0.5169934640522876, 0.5176470588235293, 0.5176470588235293, 0.5183006535947713, 0.518954248366013, 0.5196078431372549, 0.5202614379084967, 0.5202614379084967, 0.5209150326797386, 0.5215686274509803, 0.5222222222222223, 0.5222222222222223, 0.5228758169934641, 0.5235294117647059, 0.5241830065359477, 0.5248366013071896, 0.5248366013071896, 0.5254901960784314, 0.5261437908496732, 0.526797385620915, 0.526797385620915, 0.5274509803921569, 0.5281045751633987, 0.5287581699346405, 0.5287581699346405, 0.5294117647058824, 0.5300653594771242, 0.530718954248366, 0.5313725490196078, 0.5313725490196078, 0.5320261437908497, 0.5326797385620915, 0.5333333333333333, 0.5333333333333333, 0.5339869281045752, 0.534640522875817, 0.5352941176470588, 0.5359477124183006, 0.5359477124183006, 0.5366013071895425, 0.5372549019607843, 0.5379084967320261, 0.5379084967320261, 0.538562091503268, 0.5392156862745098, 0.5398692810457516, 0.5405228758169934, 0.5405228758169934, 0.5411764705882353, 0.5418300653594771, 0.5424836601307189, 0.5424836601307189, 0.5431372549019607, 0.5437908496732026, 0.5444444444444444, 0.5450980392156863, 0.5450980392156863, 0.545751633986928, 0.54640522875817, 0.5470588235294117, 0.5470588235294117, 0.5477124183006536, 0.5483660130718954, 0.5490196078431373, 0.549673202614379, 0.549673202614379, 0.550326797385621, 0.5509803921568627, 0.5516339869281046, 0.5522875816993463, 0.5522875816993463, 0.5529411764705883, 0.55359477124183, 0.5542483660130719, 0.5549019607843136, 0.5549019607843136, 0.5555555555555556, 0.5562091503267974, 0.5568627450980392, 0.5575163398692811, 0.5575163398692811, 0.5581699346405229, 0.5588235294117647, 0.5594771241830065, 0.5594771241830065, 0.5601307189542484, 0.5607843137254902, 0.561437908496732, 0.5620915032679739, 0.5620915032679739, 0.5627450980392157, 0.5633986928104575, 0.5640522875816993, 0.5647058823529412, 0.5647058823529412, 0.565359477124183, 0.5660130718954248, 0.5666666666666667, 0.5673202614379085, 0.5679738562091503, 0.5679738562091503, 0.5686274509803921, 0.569281045751634, 0.5699346405228758, 0.5705882352941176, 0.5705882352941176, 0.5712418300653594, 0.5718954248366013, 0.5725490196078431, 0.5732026143790849, 0.5738562091503268, 0.5738562091503268, 0.5745098039215686, 0.5751633986928104, 0.5758169934640522, 0.5764705882352941, 0.5771241830065359, 0.5771241830065359, 0.5777777777777777, 0.5784313725490197, 0.5790849673202614, 0.5797385620915033, 0.580392156862745, 0.580392156862745, 0.581045751633987, 0.5816993464052287, 0.5823529411764706, 0.5830065359477123, 0.5836601307189543, 0.584313725490196, 0.5849673202614379, 0.5849673202614379, 0.5856209150326797, 0.5862745098039216, 0.5869281045751633, 0.5875816993464053, 0.588235294117647, 0.5888888888888889, 0.5888888888888889, 0.5895424836601307, 0.5901960784313726, 0.5908496732026144, 0.5915032679738562, 0.592156862745098, 0.5928104575163399, 0.5934640522875817, 0.5941176470588235, 0.5947712418300654, 0.5954248366013072, 0.5954248366013072, 0.596078431372549, 0.5967320261437908, 0.5973856209150327, 0.5980392156862745, 0.5986928104575163, 0.5993464052287582, 0.6, 0.6006535947712419, 0.6013071895424836, 0.6019607843137256, 0.6026143790849673, 0.6032679738562092, 0.6039215686274509, 0.6045751633986929, 0.6052287581699346, 0.6058823529411765, 0.6065359477124183, 0.6071895424836602, 0.6078431372549019, 0.6084967320261438, 0.6091503267973856, 0.6098039215686275, 0.6104575163398692, 0.6111111111111112, 0.611764705882353, 0.6124183006535948, 0.6137254901960785, 0.6143790849673203, 0.6150326797385621, 0.615686274509804, 0.6163398692810458, 0.6169934640522876, 0.6176470588235294, 0.6189542483660131, 0.6196078431372549, 0.6202614379084967, 0.6209150326797386, 0.6215686274509804, 0.6228758169934641, 0.6235294117647059, 0.6241830065359477, 0.6254901960784314, 0.6261437908496732, 0.626797385620915, 0.6281045751633987, 0.6287581699346405, 0.6300653594771242, 0.630718954248366, 0.6313725490196078, 0.6326797385620915, 0.6339869281045752, 0.634640522875817, 0.6359477124183006, 0.6372549019607843, 0.6379084967320262, 0.6392156862745099, 0.6405228758169935, 0.6418300653594772, 0.6431372549019608, 0.6450980392156863, 0.64640522875817, 0.6477124183006536, 0.6496732026143791, 0.6516339869281046, 0.6535947712418301, 0.6562091503267974, 0.6594771241830065, 0.6627450980392157, 0.6666666666666666, 0.6705882352941176, 0.6745098039215686, 0.6771241830065359, 0.6797385620915033, 0.6816993464052288, 0.6836601307189543, 0.6856209150326797, 0.6875816993464052, 0.6888888888888889, 0.6901960784313725, 0.6915032679738562, 0.6928104575163399, 0.6941176470588235, 0.6954248366013072, 0.6967320261437908, 0.6980392156862745, 0.6993464052287581, 0.7, 0.7013071895424836, 0.7019607843137255, 0.7032679738562092, 0.7045751633986929, 0.7052287581699346, 0.7065359477124182, 0.7071895424836602, 0.7078431372549019, 0.7091503267973855, 0.7098039215686275, 0.7111111111111111, 0.711764705882353, 0.7124183006535948, 0.7137254901960784, 0.7143790849673203, 0.7150326797385621, 0.7163398692810458, 0.7169934640522876, 0.7176470588235294, 0.7183006535947711, 0.7196078431372549, 0.7202614379084967, 0.7209150326797384, 0.7215686274509804, 0.722875816993464, 0.723529411764706, 0.7241830065359477, 0.7248366013071895, 0.7254901960784313, 0.726797385620915, 0.7274509803921568, 0.7281045751633987, 0.7287581699346406, 0.7294117647058823, 0.7300653594771241, 0.730718954248366, 0.7320261437908496, 0.7326797385620915, 0.7333333333333333, 0.7339869281045752, 0.734640522875817, 0.7352941176470588, 0.7359477124183006, 0.7372549019607844, 0.7379084967320261, 0.7385620915032679, 0.7392156862745098, 0.7398692810457517, 0.7405228758169934, 0.7411764705882352, 0.7418300653594772, 0.742483660130719, 0.7431372549019607, 0.7444444444444445, 0.7450980392156863, 0.7457516339869282, 0.7464052287581698, 0.7470588235294118, 0.7477124183006536, 0.7483660130718955, 0.7490196078431371, 0.7496732026143791, 0.7509803921568629, 0.7516339869281045, 0.7522875816993464, 0.7529411764705882, 0.7535947712418302, 0.7542483660130718, 0.7549019607843137, 0.7555555555555555, 0.7562091503267975, 0.7568627450980393, 0.757516339869281, 0.7581699346405228, 0.7588235294117648, 0.7594771241830066, 0.7607843137254902, 0.7614379084967321, 0.7620915032679739, 0.7627450980392156, 0.7633986928104575, 0.7640522875816994, 0.7647058823529412, 0.765359477124183, 0.7660130718954248, 0.7666666666666667, 0.7673202614379085, 0.7679738562091504, 0.7686274509803921, 0.769281045751634, 0.7699346405228759, 0.7705882352941177, 0.7718954248366013, 0.7725490196078432, 0.773202614379085, 0.7738562091503267, 0.7745098039215687, 0.7751633986928105, 0.7758169934640523, 0.776470588235294, 0.777124183006536, 0.7777777777777778, 0.7784313725490196, 0.7790849673202616, 0.7797385620915033, 0.7803921568627451, 0.7810457516339869, 0.7823529411764706, 0.7830065359477124, 0.7836601307189542, 0.7843137254901962, 0.7849673202614379, 0.7856209150326797, 0.7862745098039216, 0.7869281045751635, 0.7875816993464052, 0.788235294117647, 0.7895424836601308, 0.7901960784313726, 0.7908496732026143, 0.7915032679738562, 0.7921568627450981, 0.7928104575163399, 0.7934640522875817, 0.7941176470588235, 0.7947712418300654, 0.7954248366013073, 0.7967320261437908, 0.7973856209150327, 0.7980392156862746, 0.7986928104575163, 0.7993464052287581, 0.8, 0.8006535947712419, 0.8013071895424837, 0.8019607843137254, 0.8032679738562092, 0.803921568627451, 0.8045751633986927, 0.8052287581699347, 0.8058823529411765, 0.8065359477124183, 0.80718954248366, 0.807843137254902, 0.8084967320261438, 0.8091503267973856, 0.8104575163398693, 0.8111111111111111, 0.8117647058823529, 0.8124183006535949, 0.8130718954248366, 0.8137254901960784, 0.8143790849673203, 0.8150326797385622, 0.8156862745098039, 0.8169934640522876, 0.8176470588235295, 0.8183006535947712, 0.818954248366013, 0.8196078431372549, 0.8202614379084968, 0.8209150326797385, 0.8215686274509804, 0.8222222222222222, 0.8228758169934641, 0.8241830065359477, 0.8248366013071895, 0.8254901960784314, 0.8261437908496733, 0.826797385620915, 0.8274509803921568, 0.8281045751633987, 0.8287581699346406, 0.8294117647058823, 0.8300653594771241, 0.8313725490196079, 0.8320261437908496, 0.8326797385620914, 0.8333333333333334, 0.8339869281045752, 0.8352941176470587, 0.8359477124183007, 0.8372549019607843, 0.837908496732026, 0.8392156862745098, 0.8398692810457516, 0.8411764705882353, 0.8418300653594771, 0.8431372549019607, 0.8437908496732026, 0.8444444444444444, 0.8457516339869282, 0.8464052287581699, 0.8477124183006536, 0.8483660130718955, 0.8496732026143791, 0.8503267973856209, 0.8516339869281045, 0.8522875816993464, 0.8529411764705882, 0.8542483660130719, 0.8549019607843137, 0.8562091503267975, 0.8568627450980393, 0.8581699346405228, 0.8588235294117648, 0.8594771241830066, 0.8607843137254901, 0.8614379084967321, 0.8627450980392156, 0.8633986928104574, 0.8647058823529412, 0.8653594771241829, 0.8660130718954248, 0.8673202614379085, 0.8679738562091504, 0.869281045751634, 0.8699346405228758, 0.8712418300653594, 0.8718954248366013, 0.873202614379085, 0.8738562091503267, 0.8745098039215686, 0.8758169934640523, 0.876470588235294, 0.8777777777777778, 0.8784313725490196, 0.8797385620915033, 0.8803921568627451, 0.8810457516339869, 0.8823529411764706, 0.8830065359477124, 0.8843137254901962, 0.8849673202614379, 0.8862745098039215, 0.8869281045751635, 0.8875816993464052, 0.8888888888888888, 0.8895424836601308, 0.8908496732026143, 0.8915032679738562, 0.8928104575163399, 0.8934640522875816, 0.8947712418300654, 0.8954248366013072, 0.896078431372549, 0.8973856209150327, 0.8980392156862745, 0.8993464052287581, 0.9, 0.9013071895424838, 0.9019607843137254, 0.9026143790849673, 0.9039215686274511, 0.9045751633986927, 0.9058823529411765, 0.9065359477124184, 0.907843137254902, 0.9084967320261438, 0.9098039215686273, 0.9104575163398693, 0.9111111111111111, 0.9124183006535949, 0.9130718954248366, 0.9143790849673203, 0.9150326797385622, 0.9163398692810457, 0.9169934640522877, 0.9183006535947712, 0.918954248366013, 0.9202614379084968, 0.9209150326797385, 0.9222222222222223, 0.9228758169934641, 0.9241830065359476, 0.9248366013071896, 0.9261437908496732, 0.926797385620915, 0.9281045751633987, 0.9287581699346406, 0.9300653594771242, 0.930718954248366, 0.9320261437908496, 0.9333333333333333, 0.9339869281045752, 0.9352941176470588, 0.9359477124183007, 0.9372549019607844, 0.938562091503268, 0.9392156862745098, 0.9405228758169935, 0.9418300653594771, 0.942483660130719, 0.9437908496732026, 0.9450980392156864, 0.9464052287581699, 0.9470588235294117, 0.9483660130718955, 0.949673202614379, 0.9509803921568628, 0.9522875816993464, 0.9535947712418301, 0.9549019607843137, 0.9562091503267974, 0.957516339869281, 0.9588235294117647, 0.9601307189542483, 0.961437908496732, 0.9627450980392156, 0.9647058823529412, 0.9660130718954248, 0.9679738562091504, 0.969281045751634, 0.9712418300653595, 0.9732026143790851, 0.9751633986928104, 0.9771241830065359, 0.9797385620915032, 0.9823529411764705, 0.9849673202614379, 0.9888888888888889]);
  gl.texImage2D(gl.TEXTURE_2D, level, internalFormat, width, height, border, format, type, data);

  // set the filtering so we don't need mips and it's not filtered
  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
  // Texture wrapping
  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);
  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
  
  const textureLocation = gl.getUniformLocation(program, 'hues');
  // Tell the shader to use texture unit 0 for u_texture
  gl.uniform1i(textureLocation, 0);
}

function createProgram(gl, vertexShader, fragmentShader) {
  const program = gl.createProgram();
  gl.attachShader(program, vertexShader);
  gl.attachShader(program, fragmentShader);
  gl.linkProgram(program);
  const success = gl.getProgramParameter(program, gl.LINK_STATUS);
  if (success) {
    return program;
  }

  console.log(gl.getProgramInfoLog(program));
  gl.deleteProgram(program);
}

function createShader(gl, type, source) {
  const shader = gl.createShader(type);
  gl.shaderSource(shader, source);
  gl.compileShader(shader);
  const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);
  if (success) {
    return shader;
  }
  console.log(gl.getShaderInfoLog(shader));
  gl.deleteShader(shader);
}



